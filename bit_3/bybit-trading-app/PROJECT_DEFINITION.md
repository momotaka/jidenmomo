# Bybit Trading App - プロジェクト定義書

## 概要
Bybitテストネット対応の暗号通貨取引アプリケーション。リアルタイム価格表示、手動取引、AI自動取引機能を提供。

## 主要機能

### 1. リアルタイム市場データ
- **WebSocket接続**: リアルタイム価格更新（1秒ごと）
- **対応通貨ペア**: BTC/USDT、ETH/USDT、SOL/USDT
- **価格情報**: Bid/Ask、最終価格、24時間出来高、24時間変動率
- **接続状態表示**: WebSocket接続状態のビジュアル表示

### 2. チャート機能
- **ローソク足チャート**: OHLCV（始値・高値・安値・終値・出来高）表示
- **時間枠**: 1分、5分、15分、1時間足に対応
- **インタラクティブ機能**: ホバー時の詳細情報表示
- **最新価格ライン**: リアルタイム価格の視覚的表示
- **自動更新**: 5秒ごとのデータ更新

### 3. 手動取引機能
- **注文タイプ**: 成行注文、指値注文
- **売買方向**: ロング（買い）、ショート（売り）
- **注文フォーム**: 数量、価格（指値の場合）入力
- **即時実行**: APIを通じた注文の即座実行

### 4. ポジション管理
- **ポジション一覧**: 現在保有中のポジション表示
- **詳細情報**: エントリー価格、現在価格、サイズ、証拠金
- **損益表示**: 未実現損益（金額・パーセンテージ）
- **自動更新**: 5秒ごとのポジション情報更新

### 5. 残高管理
- **マルチ通貨対応**: 複数の暗号通貨残高表示
- **残高詳細**: 利用可能残高、使用中残高、合計残高
- **自動更新**: 10秒ごとの残高情報更新

### 6. データ収集・保存（MySQL）
- **価格データ収集**: 
  - 複数時間枠のローソク足データ自動収集
  - 1分ごとの定期実行
- **データベーステーブル**:
  - `Candle`: 価格データ（OHLCV）
  - `Trade`: 取引履歴
  - `Position`: ポジション履歴
  - `Balance`: 残高履歴
  - `Signal`: 取引シグナル記録

### 7. テクニカル指標
- **移動平均**: SMA（単純移動平均）、EMA（指数移動平均）
- **オシレーター**: RSI、MACD、ストキャスティクス
- **ボラティリティ**: ボリンジャーバンド、ATR
- **その他**: VWAP、サポート・レジスタンス検出
- **トレンド判定**: 上昇・下降・横ばいトレンドの自動判定

### 8. 自動取引戦略
#### 戦略フレームワーク
- **基底クラス**: `BaseStrategy` - 全戦略の共通インターフェース
- **シグナル生成**: Buy/Sell/Hold判定と強度（0-1）
- **リスク管理**: ポジションサイジング、リスク評価

#### 実装済み戦略
1. **移動平均クロス戦略** (`MACrossoverStrategy`)
   - ゴールデンクロス/デッドクロス検出
   - RSI確認による精度向上
   - ATRベースのストップロス/テイクプロフィット

2. **RSI戦略** (`RSIStrategy`)
   - 買われすぎ/売られすぎゾーンでの反転
   - RSIダイバージェンス検出
   - ボリンジャーバンドとの複合判定

### 9. 自動取引エンジン
- **マルチシンボル対応**: 複数通貨ペアの同時監視
- **マルチストラテジー**: 複数戦略の並列実行
- **実行間隔**: 設定可能な戦略チェック間隔
- **ペーパートレーディング**: 実際の資金を使わないシミュレーション
- **ポジション制限**: 最大同時保有ポジション数の制限

### 10. リスク管理機能
- **ポジションサイジング**: Kelly基準に基づく適切なサイズ計算
- **最大ポジションサイズ**: 残高に対する最大投資比率制限
- **最大ドローダウン**: 許容最大損失の設定
- **リスクパートレード**: 1取引あたりのリスク制限（残高の％）
- **レバレッジ管理**: レバレッジ倍率の設定

### 11. パフォーマンス分析
- **取引統計**: 総取引数、勝率、損益
- **プロフィットファクター**: 総利益/総損失の比率
- **期間指定分析**: 任意期間のパフォーマンス計算
- **戦略別分析**: 各戦略のパフォーマンス比較

### 12. API エンドポイント
- `GET /api/ticker/[symbol]`: リアルタイム価格取得
- `GET /api/balance`: 残高情報取得
- `POST /api/order`: 注文実行
- `GET /api/positions`: ポジション一覧取得
- `GET /api/ohlcv/[symbol]`: チャートデータ取得
- `GET /api/signals/recent`: 最近のシグナル取得
- `POST /api/engine/start`: 自動取引エンジン起動
- `POST /api/engine/stop`: 自動取引エンジン停止

## 技術スタック
- **フロントエンド**: Next.js 14 (App Router), TypeScript, Tailwind CSS
- **バックエンド**: Next.js API Routes, Node.js
- **データベース**: MySQL + Prisma ORM
- **取引所API**: CCXT (Bybit対応)
- **リアルタイム通信**: Socket.io
- **チャート**: カスタムSVGローソク足チャート
- **テクニカル分析**: technicalindicators

## セキュリティ・設定
- **環境変数管理**: `.env.local`でAPI認証情報を管理
- **テストネット対応**: Bybitテストネット専用設定
- **APIキー保護**: サーバーサイドでのみAPIキー使用

## 今後の拡張予定
- バックテスト機能の実装
- 機械学習モデルの統合
- より高度な取引戦略の追加
- リアルタイムアラート機能
- モバイル対応

## インストール・実行方法
```bash
# 依存関係のインストール
npm install

# データベースのマイグレーション
npx prisma migrate dev

# 開発サーバーの起動
npm run dev
```

## 必要な環境変数
```
BYBIT_API_KEY=your_testnet_api_key
BYBIT_API_SECRET=your_testnet_api_secret
BYBIT_TESTNET=true
NEXT_PUBLIC_WS_URL=ws://localhost:3001
DATABASE_URL=mysql://user:password@localhost:3306/bybit_trading
```